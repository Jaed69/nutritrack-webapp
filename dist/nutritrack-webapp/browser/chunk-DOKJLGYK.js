import{a as ee}from"./chunk-FUAPCROJ.js";import{a as ie}from"./chunk-5ZQY3ATP.js";import{a as te}from"./chunk-MUQBBXYO.js";import{b as R,c as l,d as L,e as V,g as z,h as B,i as U,j as $,k as Y,l as H,m as J,n as K,o as Q,p as W,q as X,s as Z}from"./chunk-YUBUCD23.js";import"./chunk-6LZ2YNEV.js";import{A as g,Aa as G,B as D,K as s,L as d,N as k,O as j,P as h,Q as e,R as t,S as u,W as w,Y as S,_ as x,aa as E,ca as i,da as F,ea as I,o as N,p as y,ra as T,u as f,y as c,za as A}from"./chunk-S3CJXT6Z.js";import{a as M,b as q}from"./chunk-2VMXMS7J.js";var oe=(r,a)=>a.id;function re(r,a){r&1&&(e(0,"span",9),i(1,"El nombre es obligatorio"),t())}function ae(r,a){r&1&&(e(0,"span",9),i(1,"El nombre debe tener al menos 5 caracteres"),t())}function le(r,a){r&1&&(e(0,"span",9),i(1,"La descripci\xF3n es obligatoria"),t())}function ce(r,a){r&1&&(e(0,"span",9),i(1,"La duraci\xF3n es obligatoria"),t())}function me(r,a){r&1&&(e(0,"span",9),i(1,"La duraci\xF3n m\xEDnima es 1 d\xEDa"),t())}function se(r,a){r&1&&(e(0,"div",34),i(1,"Cargando etiquetas..."),t())}function de(r,a){if(r&1){let o=w();e(0,"label",39)(1,"input",40),S("change",function(){let m=N(o).$implicit,p=x(2);return y(p.toggleEtiqueta(m.id))}),t(),e(2,"span",41),i(3),t()()}if(r&2){let o=a.$implicit,n=x(2);c(),h("checked",n.etiquetasSeleccionadas().includes(o.id)),c(2),F(o.nombre)}}function ue(r,a){if(r&1&&(e(0,"div",35),k(1,de,4,2,"label",39,oe),t()),r&2){let o=x();c(),j(o.etiquetas())}}var ne=class r{constructor(a,o,n,m,p){this.fb=a;this.planService=o;this.etiquetaService=n;this.notificationService=m;this.router=p;this.inicializarFormulario()}formulario;guardando=f(!1);cargandoEtiquetas=f(!1);etiquetas=f([]);etiquetasSeleccionadas=f([]);ngOnInit(){this.cargarEtiquetas()}inicializarFormulario(){this.formulario=this.fb.group({nombre:["",[l.required,l.minLength(5)]],descripcion:["",[l.required,l.minLength(10)]],duracionDias:[7,[l.required,l.min(1),l.max(365)]],objetivo:this.fb.group({tipoObjetivo:["",l.required],caloriasObjetivo:[2e3,[l.required,l.min(1e3),l.max(5e3)]],proteinasObjetivo:[150,[l.required,l.min(0)]],carbohidratosObjetivo:[200,[l.required,l.min(0)]],grasasObjetivo:[70,[l.required,l.min(0)]]})})}cargarEtiquetas(){this.cargandoEtiquetas.set(!0),this.etiquetaService.obtenerTodas().subscribe({next:a=>{this.cargandoEtiquetas.set(!1),this.etiquetas.set(a)},error:()=>{this.cargandoEtiquetas.set(!1),this.notificationService.showError("Error al cargar etiquetas")}})}toggleEtiqueta(a){let o=this.etiquetasSeleccionadas();o.includes(a)?this.etiquetasSeleccionadas.set(o.filter(n=>n!==a)):this.etiquetasSeleccionadas.set([...o,a])}guardar(){if(this.formulario.invalid){this.formulario.markAllAsTouched(),this.notificationService.showError("Por favor completa todos los campos requeridos");return}this.guardando.set(!0);let a=q(M({},this.formulario.value),{etiquetaIds:this.etiquetasSeleccionadas()});this.planService.crearPlan(a).subscribe({next:o=>{this.guardando.set(!1),o.success&&(this.notificationService.showSuccess("Plan creado exitosamente"),this.router.navigate(["/admin/planes"]))},error:o=>{this.guardando.set(!1),o.status===409?this.notificationService.showError("Ya existe un plan con ese nombre (RN11)"):o.status===400?this.notificationService.showError(o.error.message||"Datos inv\xE1lidos"):this.notificationService.showError("Error al crear plan")}})}static \u0275fac=function(o){return new(o||r)(g(X),g(ie),g(ee),g(te),g(A))};static \u0275cmp=D({type:r,selectors:[["app-crear-plan"]],decls:97,vars:16,consts:[[1,"crear-plan-container"],[1,"header"],["routerLink","/admin/planes",1,"btn-link"],[1,"plan-form",3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-group"],["for","nombre"],[1,"required"],["id","nombre","type","text","formControlName","nombre","placeholder","Ej: Plan P\xE9rdida de Peso - 7 d\xEDas"],[1,"error-text"],[1,"help-text"],["for","descripcion"],["id","descripcion","formControlName","descripcion","rows","4","placeholder","Describe los beneficios y caracter\xEDsticas del plan..."],["for","duracionDias"],["id","duracionDias","type","number","formControlName","duracionDias","min","1","max","365"],["formGroupName","objetivo"],["for","tipoObjetivo"],["id","tipoObjetivo","formControlName","tipoObjetivo"],["value",""],["value","PERDIDA_PESO"],["value","GANANCIA_MUSCULAR"],["value","MANTENIMIENTO"],["value","DEFINICION"],["value","SALUD_GENERAL"],[1,"form-row"],["for","calorias"],["id","calorias","type","number","formControlName","caloriasObjetivo","min","1000","max","5000","step","50"],["for","proteinas"],["id","proteinas","type","number","formControlName","proteinasObjetivo","min","0","step","5"],["for","carbohidratos"],["id","carbohidratos","type","number","formControlName","carbohidratosObjetivo","min","0","step","5"],["for","grasas"],["id","grasas","type","number","formControlName","grasasObjetivo","min","0","step","5"],[1,"section-description"],[1,"loading"],[1,"etiquetas-grid"],[1,"form-actions"],["type","button","routerLink","/admin/planes",1,"btn-secondary"],["type","submit",1,"btn-primary",3,"disabled"],[1,"checkbox-card"],["type","checkbox",3,"change","checked"],[1,"checkbox-label"]],template:function(o,n){if(o&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),i(3,"Crear Plan Nutricional"),t(),e(4,"button",2),i(5,"\u2190 Volver a planes"),t()(),e(6,"form",3),S("ngSubmit",function(){return n.guardar()}),e(7,"div",4)(8,"h2"),i(9,"Informaci\xF3n B\xE1sica"),t(),e(10,"div",5)(11,"label",6),i(12,"Nombre del Plan "),e(13,"span",7),i(14,"*"),t()(),u(15,"input",8),s(16,re,2,0,"span",9),s(17,ae,2,0,"span",9),e(18,"small",10),i(19,"El nombre debe ser \xFAnico (RN11)"),t()(),e(20,"div",5)(21,"label",11),i(22,"Descripci\xF3n "),e(23,"span",7),i(24,"*"),t()(),u(25,"textarea",12),s(26,le,2,0,"span",9),t(),e(27,"div",5)(28,"label",13),i(29,"Duraci\xF3n (d\xEDas) "),e(30,"span",7),i(31,"*"),t()(),u(32,"input",14),s(33,ce,2,0,"span",9),s(34,me,2,0,"span",9),t()(),e(35,"div",4)(36,"h2"),i(37,"Objetivos Nutricionales"),t(),e(38,"div",15)(39,"div",5)(40,"label",16),i(41,"Tipo de Objetivo "),e(42,"span",7),i(43,"*"),t()(),e(44,"select",17)(45,"option",18),i(46,"Selecciona un objetivo"),t(),e(47,"option",19),i(48,"P\xE9rdida de Peso"),t(),e(49,"option",20),i(50,"Ganancia Muscular"),t(),e(51,"option",21),i(52,"Mantenimiento"),t(),e(53,"option",22),i(54,"Definici\xF3n"),t(),e(55,"option",23),i(56,"Salud General"),t()()(),e(57,"div",24)(58,"div",5)(59,"label",25),i(60,"Calor\xEDas Objetivo (kcal) "),e(61,"span",7),i(62,"*"),t()(),u(63,"input",26),t(),e(64,"div",5)(65,"label",27),i(66,"Prote\xEDnas (g) "),e(67,"span",7),i(68,"*"),t()(),u(69,"input",28),t()(),e(70,"div",24)(71,"div",5)(72,"label",29),i(73,"Carbohidratos (g) "),e(74,"span",7),i(75,"*"),t()(),u(76,"input",30),t(),e(77,"div",5)(78,"label",31),i(79,"Grasas (g) "),e(80,"span",7),i(81,"*"),t()(),u(82,"input",32),t()()()(),e(83,"div",4)(84,"h2"),i(85,"Etiquetas"),t(),e(86,"p",33),i(87,"Selecciona las etiquetas que aplican a este plan"),t(),s(88,se,2,0,"div",34),s(89,ue,3,0,"div",35),e(90,"small",10),i(91,"Las etiquetas deben existir previamente (RN12)"),t()(),e(92,"div",36)(93,"button",37),i(94," Cancelar "),t(),e(95,"button",38),i(96),t()()()()),o&2){let m,p,P,b,v,C,_,O;c(6),h("formGroup",n.formulario),c(9),E("error",((m=n.formulario.get("nombre"))==null?null:m.invalid)&&((m=n.formulario.get("nombre"))==null?null:m.touched)),c(),d((p=n.formulario.get("nombre"))!=null&&p.hasError("required")&&((p=n.formulario.get("nombre"))!=null&&p.touched)?16:-1),c(),d((P=n.formulario.get("nombre"))!=null&&P.hasError("minlength")?17:-1),c(8),E("error",((b=n.formulario.get("descripcion"))==null?null:b.invalid)&&((b=n.formulario.get("descripcion"))==null?null:b.touched)),c(),d((v=n.formulario.get("descripcion"))!=null&&v.hasError("required")&&((v=n.formulario.get("descripcion"))!=null&&v.touched)?26:-1),c(6),E("error",((C=n.formulario.get("duracionDias"))==null?null:C.invalid)&&((C=n.formulario.get("duracionDias"))==null?null:C.touched)),c(),d((_=n.formulario.get("duracionDias"))!=null&&_.hasError("required")&&((_=n.formulario.get("duracionDias"))!=null&&_.touched)?33:-1),c(),d((O=n.formulario.get("duracionDias"))!=null&&O.hasError("min")?34:-1),c(54),d(n.cargandoEtiquetas()?88:-1),c(),d(!n.cargandoEtiquetas()&&n.etiquetas().length>0?89:-1),c(6),h("disabled",n.formulario.invalid||n.guardando()),c(),I(" ",n.guardando()?"Guardando...":"Crear Plan"," ")}},dependencies:[T,G,Z,z,J,K,R,B,H,L,V,W,Q,U,Y,$],styles:[".crear-plan-container[_ngcontent-%COMP%]{padding:2rem;max-width:900px;margin:0 auto}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}h1[_ngcontent-%COMP%]{font-size:2rem;color:#2d3748;margin:0}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#667eea;font-weight:600;cursor:pointer;font-size:1rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.plan-form[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;box-shadow:0 2px 8px #0000001a}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e2e8f0}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;color:#2d3748;margin-bottom:.5rem}.section-description[_ngcontent-%COMP%]{color:#718096;margin-bottom:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}label[_ngcontent-%COMP%]{display:block;font-weight:600;color:#4a5568;margin-bottom:.5rem}.required[_ngcontent-%COMP%]{color:#e53e3e}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:.75rem;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:border-color .2s}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea}input.error[_ngcontent-%COMP%], select.error[_ngcontent-%COMP%], textarea.error[_ngcontent-%COMP%]{border-color:#fc8181}.error-text[_ngcontent-%COMP%]{display:block;color:#e53e3e;font-size:.875rem;margin-top:.25rem}.help-text[_ngcontent-%COMP%]{display:block;color:#718096;font-size:.875rem;margin-top:.25rem}.etiquetas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem}.checkbox-card[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem;border:2px solid #e2e8f0;border-radius:8px;cursor:pointer;transition:all .2s}.checkbox-card[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#f7fafc}.checkbox-card[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto;margin-right:.5rem}.checkbox-card[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .checkbox-label[_ngcontent-%COMP%]{font-weight:600;color:#667eea}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;padding-top:2rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:.75rem 2rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .2s;font-size:1rem}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#edf2f7;color:#4a5568}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e2e8f0}.loading[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#718096}"]})};export{ne as CrearPlanComponent};
