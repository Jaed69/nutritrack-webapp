import{a as U}from"./chunk-FUAPCROJ.js";import{b as Q}from"./chunk-3XSRQ24Y.js";import{a as W}from"./chunk-MUQBBXYO.js";import{b as F,c as p,d as k,e as j,g as T,h as I,i as V,k as D,l as G,m as z,n as R,o as $,p as L,q as B,s as K}from"./chunk-YUBUCD23.js";import"./chunk-6LZ2YNEV.js";import{B as N,K as u,L as f,N as P,O as E,P as b,Q as n,R as t,S as m,W as v,Y as x,_ as d,ca as a,da as O,ea as M,n as g,o as _,p as C,ra as A,u as s,y as c,za as w}from"./chunk-S3CJXT6Z.js";import{a as y,b as q,c as S}from"./chunk-2VMXMS7J.js";var H=(o,e)=>e.id;function J(o,e){o&1&&(n(0,"div",4),m(1,"div",6),n(2,"p"),a(3,"Cargando perfil..."),t()())}function X(o,e){o&1&&(n(0,"span",21),a(1,"Altura m\xEDnima: 50 cm"),t())}function Z(o,e){o&1&&(n(0,"span",21),a(1,"Altura m\xE1xima: 300 cm"),t())}function ee(o,e){if(o&1){let i=v();n(0,"label",34)(1,"input",35),x("change",function(){let r=_(i).$implicit,h=d(3);return C(h.toggleAlergia(r.id))}),t(),n(2,"span",36),a(3),t()()}if(o&2){let i=e.$implicit,l=d(3);c(),b("value",i.id)("checked",l.isAlergiaSeleccionada(i.id)),c(2),O(i.nombre)}}function te(o,e){if(o&1&&(n(0,"div",29),P(1,ee,4,3,"label",34,H),t()),o&2){let i=d(2);c(),E(i.etiquetasAlergias())}}function ie(o,e){o&1&&(n(0,"p",30),a(1,"No hay alergias disponibles"),t())}function ne(o,e){if(o&1){let i=v();n(0,"label",34)(1,"input",35),x("change",function(){let r=_(i).$implicit,h=d(3);return C(h.toggleCondicion(r.id))}),t(),n(2,"span",36),a(3),t()()}if(o&2){let i=e.$implicit,l=d(3);c(),b("value",i.id)("checked",l.isCondicionSeleccionada(i.id)),c(2),O(i.nombre)}}function oe(o,e){if(o&1&&(n(0,"div",29),P(1,ne,4,3,"label",34,H),t()),o&2){let i=d(2);c(),E(i.etiquetasCondiciones())}}function ae(o,e){o&1&&(n(0,"p",30),a(1,"No hay condiciones disponibles"),t())}function re(o,e){o&1&&(m(0,"span",37),a(1," Guardando... "))}function le(o,e){o&1&&a(0," Guardar Perfil ")}function ce(o,e){if(o&1){let i=v();n(0,"form",7),x("ngSubmit",function(){_(i);let r=d();return C(r.guardar())}),n(1,"div",8)(2,"h3"),a(3,"Informaci\xF3n Personal"),t(),n(4,"div",9)(5,"div",10)(6,"label",11),a(7,"Fecha de Nacimiento"),t(),m(8,"input",12),t(),n(9,"div",10)(10,"label",13),a(11,"G\xE9nero"),t(),n(12,"select",14)(13,"option",15),a(14,"Seleccionar..."),t(),n(15,"option",16),a(16,"Masculino"),t(),n(17,"option",17),a(18,"Femenino"),t(),n(19,"option",18),a(20,"Otro"),t()()()()(),n(21,"div",8)(22,"h3"),a(23,"Medidas"),t(),n(24,"div",9)(25,"div",10)(26,"label",19),a(27,"Altura (cm)"),t(),m(28,"input",20),u(29,X,2,0,"span",21),u(30,Z,2,0,"span",21),t(),n(31,"div",10)(32,"label",22),a(33),t(),m(34,"input",23),t(),n(35,"div",10)(36,"label",24),a(37),t(),m(38,"input",25),t()()(),n(39,"div",8)(40,"h3"),a(41,"Objetivo"),t(),n(42,"div",10)(43,"label",26),a(44,"Describe tu objetivo actual"),t(),m(45,"textarea",27),t()(),n(46,"div",8)(47,"h3"),a(48,"Alergias Alimentarias \u26A0\uFE0F"),t(),n(49,"p",28),a(50," Selecciona tus alergias para que el sistema filtre planes incompatibles "),t(),u(51,te,3,0,"div",29)(52,ie,2,0,"p",30),t(),n(53,"div",8)(54,"h3"),a(55,"Condiciones de Salud"),t(),n(56,"p",28),a(57," Selecciona condiciones que puedan afectar tu plan nutricional "),t(),u(58,oe,3,0,"div",29)(59,ae,2,0,"p",30),t(),n(60,"div",31)(61,"button",32),x("click",function(){_(i);let r=d();return C(r.cancelar())}),a(62," Cancelar "),t(),n(63,"button",33),u(64,re,2,0)(65,le,1,0),t()()()}if(o&2){let i,l,r=d();b("formGroup",r.perfilForm),c(29),f((i=r.perfilForm.get("altura"))!=null&&i.hasError("min")?29:-1),c(),f((l=r.perfilForm.get("altura"))!=null&&l.hasError("max")?30:-1),c(3),M("Peso Actual (",r.unidadPeso(),")"),c(4),M("Peso Objetivo (",r.unidadPeso(),")"),c(14),f(r.etiquetasAlergias().length>0?51:52),c(7),f(r.etiquetasCondiciones().length>0?58:59),c(5),b("disabled",r.saving()||!r.perfilForm.valid),c(),f(r.saving()?64:65)}}var Y=class o{fb=g(B);perfilService=g(Q);etiquetaService=g(U);notificationService=g(W);router=g(w);perfilForm;loading=s(!0);saving=s(!1);etiquetasAlergias=s([]);etiquetasCondiciones=s([]);alergiasSeleccionadas=s([]);condicionesSeleccionadas=s([]);unidadPeso=s("KG");ngOnInit(){this.inicializarFormulario(),this.cargarDatos()}inicializarFormulario(){this.perfilForm=this.fb.group({altura:["",[p.min(50),p.max(300)]],pesoActual:["",[p.min(20),p.max(600)]],pesoObjetivo:["",[p.min(20),p.max(600)]],fechaNacimiento:[""],genero:[""],objetivoActual:["",[p.maxLength(500)]]})}cargarDatos(){Promise.all([this.cargarEtiquetas(),this.cargarPerfilActual()]).finally(()=>{this.loading.set(!1)})}cargarEtiquetas(){return S(this,null,function*(){try{let[e,i]=yield Promise.all([this.etiquetaService.obtenerPorTipo("alergia").toPromise(),this.etiquetaService.obtenerPorTipo("condicion").toPromise()]);this.etiquetasAlergias.set(e||[]),this.etiquetasCondiciones.set(i||[])}catch(e){console.error("Error al cargar etiquetas:",e),this.notificationService.showError("Error al cargar etiquetas")}})}cargarPerfilActual(){return S(this,null,function*(){try{let e=yield this.perfilService.obtenerPerfil().toPromise();if(e){this.unidadPeso.set(e.unidadesMedida),this.perfilForm.patchValue({altura:e.altura,pesoActual:e.pesoActual,pesoObjetivo:e.pesoObjetivo,fechaNacimiento:e.fechaNacimiento,genero:e.genero,objetivoActual:e.objetivoActual});let i=e.etiquetasSalud.filter(r=>r.tipo==="alergia").map(r=>r.id);this.alergiasSeleccionadas.set(i);let l=e.etiquetasSalud.filter(r=>r.tipo==="condicion").map(r=>r.id);this.condicionesSeleccionadas.set(l)}}catch(e){console.error("Error al cargar perfil:",e)}})}toggleAlergia(e){let i=this.alergiasSeleccionadas();i.includes(e)?this.alergiasSeleccionadas.set(i.filter(l=>l!==e)):this.alergiasSeleccionadas.set([...i,e])}toggleCondicion(e){let i=this.condicionesSeleccionadas();i.includes(e)?this.condicionesSeleccionadas.set(i.filter(l=>l!==e)):this.condicionesSeleccionadas.set([...i,e])}isAlergiaSeleccionada(e){return this.alergiasSeleccionadas().includes(e)}isCondicionSeleccionada(e){return this.condicionesSeleccionadas().includes(e)}guardar(){if(this.perfilForm.invalid){this.notificationService.showWarning("Por favor completa el formulario correctamente");return}this.saving.set(!0);let e=[...this.alergiasSeleccionadas(),...this.condicionesSeleccionadas()],i=q(y({},this.perfilForm.value),{etiquetaSaludIds:e});this.perfilService.actualizarPerfilSalud(i).subscribe({next:()=>{this.notificationService.showSuccess("Perfil de salud actualizado correctamente"),this.router.navigate(["/dashboard"])},error:l=>{console.error("Error al actualizar perfil:",l),this.notificationService.showError("Error al actualizar perfil"),this.saving.set(!1)},complete:()=>{this.saving.set(!1)}})}cancelar(){this.router.navigate(["/dashboard"])}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=N({type:o,selectors:[["app-perfil-salud"]],decls:10,vars:1,consts:[[1,"perfil-salud-container"],[1,"card"],[1,"card-header"],[1,"card-body"],[1,"loading-spinner"],[3,"formGroup"],[1,"spinner"],[3,"ngSubmit","formGroup"],[1,"form-section"],[1,"form-row"],[1,"form-group"],["for","fechaNacimiento"],["type","date","id","fechaNacimiento","formControlName","fechaNacimiento",1,"form-control"],["for","genero"],["id","genero","formControlName","genero",1,"form-control"],["value",""],["value","MASCULINO"],["value","FEMENINO"],["value","OTRO"],["for","altura"],["type","number","id","altura","formControlName","altura","placeholder","Ej: 170","min","50","max","300",1,"form-control"],[1,"error"],["for","pesoActual"],["type","number","id","pesoActual","formControlName","pesoActual","placeholder","Ej: 70","min","20","max","600","step","0.1",1,"form-control"],["for","pesoObjetivo"],["type","number","id","pesoObjetivo","formControlName","pesoObjetivo","placeholder","Ej: 65","min","20","max","600","step","0.1",1,"form-control"],["for","objetivoActual"],["id","objetivoActual","formControlName","objetivoActual","rows","3","placeholder","Ej: Quiero perder peso gradualmente y ganar masa muscular",1,"form-control"],[1,"section-description"],[1,"etiquetas-grid"],[1,"no-data"],[1,"form-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"etiqueta-checkbox"],["type","checkbox",3,"change","value","checked"],[1,"etiqueta-label"],[1,"spinner-small"]],template:function(i,l){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),a(4,"Perfil de Salud"),t(),n(5,"p"),a(6,"Configura tu informaci\xF3n de salud, alergias y objetivos"),t()(),n(7,"div",3),u(8,J,4,0,"div",4)(9,ce,66,9,"form",5),t()()()),i&2&&(c(8),f(l.loading()?8:9))},dependencies:[A,K,T,z,R,F,I,G,k,j,L,$,V,D],styles:[".perfil-salud-container[_ngcontent-%COMP%]{max-width:900px;margin:2rem auto;padding:0 1rem}.card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 8px #0000001a;overflow:hidden}.card-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:2rem}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem}.card-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;opacity:.9}.card-body[_ngcontent-%COMP%]{padding:2rem}.form-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:2rem;border-bottom:1px solid #e0e0e0}.form-section[_ngcontent-%COMP%]:last-of-type{border-bottom:none}.form-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:1rem;color:#333}.section-description[_ngcontent-%COMP%]{font-size:.875rem;color:#666;margin-bottom:1rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin-bottom:1rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.5rem;color:#444}.form-control[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;transition:border-color .2s}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px #667eea1a}.error[_ngcontent-%COMP%]{color:#e74c3c;font-size:.875rem;margin-top:.25rem}.etiquetas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem}.etiqueta-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem;border:2px solid #e0e0e0;border-radius:6px;cursor:pointer;transition:all .2s}.etiqueta-checkbox[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#f8f9ff}.etiqueta-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:.5rem;width:18px;height:18px;cursor:pointer}.etiqueta-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .etiqueta-label[_ngcontent-%COMP%]{font-weight:600;color:#667eea}.etiqueta-label[_ngcontent-%COMP%]{flex:1}.no-data[_ngcontent-%COMP%]{text-align:center;color:#999;padding:2rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:6px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:.5rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-secondary[_ngcontent-%COMP%]{background:#f5f5f5;color:#666}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e0e0e0}.loading-spinner[_ngcontent-%COMP%]{text-align:center;padding:3rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 1rem}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;border:2px solid #ffffff80;border-top:2px solid #ffffff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{Y as PerfilSaludComponent};
