import{a as u}from"./chunk-6LZ2YNEV.js";import{g as l,j as i,n as s,u as n,ua as g,za as c}from"./chunk-S3CJXT6Z.js";var a=class r{setItem(e,t){try{let o=JSON.stringify(t);localStorage.setItem(e,o)}catch(o){console.error("Error saving to localStorage",o)}}getItem(e){try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error("Error reading from localStorage",t),null}}removeItem(e){try{localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage",t)}}clear(){try{localStorage.clear()}catch(e){console.error("Error clearing localStorage",e)}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var d=class r{http=s(g);storage=s(a);router=s(c);apiUrl=`${u.apiUrl}/auth`;_currentUser=n(null);_isAuthenticated=n(!1);_token=n(null);currentUser=this._currentUser.asReadonly();isAuthenticated=this._isAuthenticated.asReadonly();token=this._token.asReadonly();constructor(){this.loadAuthData()}login(e){return console.log("\u{1F680} Enviando login a:",`${this.apiUrl}/login`),console.log("\u{1F4E7} Credenciales:",e.email),this.http.post(`${this.apiUrl}/login`,e).pipe(l(t=>{console.log("\u2705 Respuesta completa recibida:",t),console.log("\u2705 Response.data:",t.data),this.saveAuthData(t.data)}))}register(e){return this.http.post(`${this.apiUrl}/registro`,e).pipe(l(t=>{this.saveAuthData(t.data)}))}logout(){this.storage.removeItem("token"),this.storage.removeItem("user"),this._currentUser.set(null),this._isAuthenticated.set(!1),this._token.set(null),this.router.navigate(["/login"])}saveAuthData(e){console.log("\u{1F510} Respuesta del backend:",JSON.stringify(e,null,2)),this.storage.setItem("token",e.token),this._token.set(e.token);let t;e.role==="ROLE_ADMIN"?(t=2,console.log("\u2705 Usuario identificado como ADMIN")):(t=1,console.log("\u2705 Usuario identificado como USER")),console.log("\u{1F4CB} id_rol asignado:",t);let o={id:e.userId?.toString()||"",email:e.email,name:`${e.nombre||""} ${e.apellido||""}`.trim()||e.email,id_rol:t,active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("\u{1F464} Usuario guardado:",JSON.stringify(o,null,2)),this.storage.setItem("user",o),this._currentUser.set(o),this._isAuthenticated.set(!0),console.log("\u{1F511} Es admin?:",this.isAdmin())}loadAuthData(){let e=this.storage.getItem("token"),t=this.storage.getItem("user");e&&t&&(this._token.set(e),this._currentUser.set(t),this._isAuthenticated.set(!0))}isAdmin(){let e=this._currentUser();return e?.id_rol===2||e?.id_rol===2}isUser(){let e=this._currentUser();return e?.id_rol===1||e?.id_rol===1}getToken(){return this._token()}get currentUserValue(){return this._currentUser()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};export{d as a};
